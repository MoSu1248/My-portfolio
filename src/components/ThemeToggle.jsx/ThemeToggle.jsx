import React, { useContext, useEffect, useState } from "react";
import "./ThemeToggle.scss";
import { AppState } from "../AppStateProvider/AppStateProvider";
import { AnimatePresence, motion } from "framer-motion";

export default function ThemeToggle() {
  const { currentSection } = useContext(AppState);

  const [theme, setTheme] = useState(() => {
    const stored = localStorage.getItem("theme");
    return stored === "dim" || stored === "dark" ? stored : "dark";
  });

  useEffect(() => {
    if (theme === "dark") {
      document.documentElement.removeAttribute("data-theme");
    } else {
      document.documentElement.setAttribute("data-theme", "dim");
    }
    localStorage.setItem("theme", theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme((prev) => (prev === "dark" ? "dim" : "dark"));
  };

  return (
    <div className="theme-toggle">
      <AnimatePresence mode="wait">
        {theme === "dark" ? (
          <motion.svg
            onClick={toggleTheme}
            key="dim"
            initial={{ opacity: 0, y: -10, scale: 0.8 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: 10, scale: 0.8 }}
            transition={{ duration: 0.3 }}
            width="28"
            height="28"
            viewBox="0 0 24 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M23.0001 12.5C23.0001 18.8513 18.0753 24 12.0001 24C11.9998 19.5 12 19.3981 12 13.0469C12 6.6956 12.0001 10 12.0001 1C18.0753 1 23.0001 6.14873 23.0001 12.5Z"
              className={`toggle__icon-${currentSection}`}
            />
            <path
              d="M12 21.6C10.1013 21.6 8.24524 21.037 6.66653 19.9821C5.08782 18.9272 3.85736 17.4279 3.13076 15.6738C2.40416 13.9196 2.21405 11.9893 2.58447 10.1271C2.95488 8.26491 3.8692 6.55436 5.21178 5.21177C6.55436 3.86919 8.26492 2.95488 10.1271 2.58446C11.9894 2.21404 13.9196 2.40415 15.6738 3.13076C17.4279 3.85736 18.9272 5.08781 19.9821 6.66652C21.037 8.24524 21.6 10.1013 21.6 12C21.6 14.5461 20.5886 16.9879 18.7882 18.7882C16.9879 20.5886 14.5461 21.6 12 21.6ZM12 0C9.62663 0 7.30655 0.703788 5.33316 2.02236C3.35977 3.34094 1.8217 5.21508 0.913451 7.4078C0.00519941 9.60051 -0.232441 12.0133 0.230582 14.3411C0.693605 16.6689 1.83649 18.807 3.51472 20.4853C5.19295 22.1635 7.33115 23.3064 9.65892 23.7694C11.9867 24.2324 14.3995 23.9948 16.5922 23.0865C18.7849 22.1783 20.6591 20.6402 21.9776 18.6668C23.2962 16.6934 24 14.3734 24 12C24 10.4241 23.6896 8.8637 23.0866 7.4078C22.4835 5.95189 21.5996 4.62902 20.4853 3.51472C19.371 2.40042 18.0481 1.5165 16.5922 0.913445C15.1363 0.310389 13.5759 0 12 0Z"
              className={`toggle__icon-${currentSection}`}
            />
          </motion.svg>
        ) : (
          <motion.svg
            onClick={toggleTheme}
            key="dark"
            initial={{ opacity: 0, y: -10, scale: 0.8 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: 10, scale: 0.8 }}
            transition={{ duration: 0.3 }}
            width="18"
            height="18"
            viewBox="0 0 12 12"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              className={`toggle__icon-${currentSection}`}
              d="M10.8333 5.82292C10.8333 7.15176 10.3055 8.42618 9.36582 9.36582C8.42618 10.3055 7.15176 10.8333 5.82292 10.8333V11.6458C9.03879 11.6458 11.6458 9.03879 11.6458 5.82292H10.8333ZM5.82292 10.8333C4.49407 10.8333 3.21965 10.3055 2.28002 9.36582C1.34038 8.42618 0.8125 7.15176 0.8125 5.82292H0C0 9.03879 2.60704 11.6458 5.82292 11.6458V10.8333ZM0.8125 5.82292C0.8125 4.49407 1.34038 3.21965 2.28002 2.28002C3.21965 1.34038 4.49407 0.8125 5.82292 0.8125V0C2.60704 0 0 2.60704 0 5.82292H0.8125ZM7.71875 7.04167C6.89271 7.04167 6.1005 6.71352 5.51641 6.12943C4.93231 5.54533 4.60417 4.75312 4.60417 3.92708H3.79167C3.79167 4.96861 4.20541 5.96748 4.94188 6.70395C5.67835 7.44042 6.67722 7.85417 7.71875 7.85417V7.04167ZM10.3865 5.53529C10.1093 5.99498 9.71803 6.37523 9.25062 6.63916C8.78321 6.90309 8.25553 7.04174 7.71875 7.04167V7.85417C8.3955 7.85437 9.06082 7.67967 9.65017 7.34703C10.2395 7.01439 10.7329 6.5351 11.0825 5.95562L10.3865 5.53529ZM4.60417 3.92708C4.60409 3.39031 4.74274 2.86262 5.00667 2.39521C5.2706 1.9278 5.65086 1.53654 6.11054 1.25937L5.69021 0.563875C5.11082 0.913404 4.63157 1.40671 4.29893 1.99597C3.9663 2.58522 3.79156 3.25042 3.79167 3.92708H4.60417ZM5.82292 0.8125C5.79569 0.811977 5.76885 0.806058 5.74393 0.795086C5.71901 0.784115 5.69652 0.768309 5.67775 0.748583C5.65491 0.725645 5.63945 0.69641 5.63333 0.664625C5.63117 0.647833 5.63225 0.599083 5.69021 0.563875L6.11054 1.25937C6.383 1.09471 6.47075 0.793 6.43879 0.55575C6.40521 0.309292 6.21129 0 5.82292 0V0.8125ZM11.0825 5.95562C11.0467 6.01358 10.998 6.01467 10.9812 6.0125C10.9494 6.00639 10.9202 5.99092 10.8972 5.96808C10.8775 5.94932 10.8617 5.92682 10.8507 5.9019C10.8398 5.87699 10.8339 5.85014 10.8333 5.82292H11.6458C11.6458 5.43454 11.3365 5.24062 11.0901 5.20704C10.8528 5.17508 10.5511 5.26283 10.3865 5.53529L11.0825 5.95562Z"
            />
          </motion.svg>
        )}
      </AnimatePresence>
    </div>
  );
}
